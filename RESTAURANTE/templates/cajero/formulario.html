{% extends "base.html" %}
{% block title %}{% if cajero %}Editar información del cajero{% else %}Agregar cajero{% endif %} · INTRACOE{% endblock %}
{% block content %}
{% load l10n %}



<div class="mx-md-5 py-3">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <div class="d-flex align-items-center mb-3">
        <a href="{% url 'cajero-lista' %}">
            <span class="material-symbols-outlined">arrow_back_ios</span>
        </a>
        <h1 class="h5 mb-0">{% if cajero %}Editar información del cajero {{ cajero.nombre }}{% else %}Agregar cajero{% endif %}</h1>
    </div>
    
    <form method="post" id="formcajero" class="needs-validation" novalidate 
        {% comment %} action="{% if cajero %}{% url 'editar-menu' cajero.id %}{% else %}{% url 'crear-menu' %}{% endif %}" {% endcomment %}
        >
        {% csrf_token %}
        <div class="row g-3 d-flex align-items-stretch">
            <div class="col-md-6 d-flex flex-column gap-3">
                <div >
                    <label class="form-label">Nombre</label>
                    <input type="text" name="nombre" class="form-control" value="{{ cajero.nombre|default:'' }}" required>
                    <div class="invalid-feedback">Obligatorio.</div>
                </div>
    
                <div>
                    <label class="form-label mb-2">Pin</label>
                    <div class="row g-2">
                        <input type="text" name="pin" class="form-control" value="{{ cajero.pin|default:'' }}" required>
                        <div class="invalid-feedback">Obligatorio.</div>
                    </div>
                    <div id="categoriaFeedback" class="invalid-feedback">
                        Obligatorio.
                    </div>
                </div>
                
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" name="activo" value="on" id="activo" {% if cajero.activo %}checked{% endif %}>
                    <label class="form-check-label" for="activo">Activo</label>
                </div>
            </div>
        </div>
        <button class="btn btn-primary mt-3" id="save_form">Guardar</button>
    </form>
    <div>
    </div>

</div>
<script>
(function () {
    // ----------------------------------------------------
    // LÓGICA DE VALIDACIÓN DEL FORMULARIO (EJECUCIÓN AL ENVIAR)
    // ----------------------------------------------------
    const form = document.getElementById('formcajero');
    const saveButton = document.getElementById('save_form'); // Obtener el botón

    // Usamos el evento del botón o el evento de submit, pero simplificamos la lógica:
    form.addEventListener('submit', (e)=>{
        if (!form.checkValidity()) {
            e.preventDefault(); // Detiene el envío si hay errores
            e.stopPropagation();
        } else {
            feedback.style.display = 'none';
        }
        // Aplica las clases de validación (debe ir aquí o justo antes del if)
        form.classList.add('was-validated'); 
    });
})();
</script>

{% endblock %}