<div class="modal fade" id="tomarOrdenModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-xl ">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title d-flex">
          <i class="bi bi-clipboard-check me-2"></i>
          <span class="mb-0">Tomar orden mesa</span>
          <p id="to_mesa_numero" class="ms-2 mb-0" readonly></p>
        </h5>
        <button type="button" class="btn-close mt-0 mb-0" data-bs-dismiss="modal"></button>
      </div>

      <form id="tomarOrdenForm" method="post" action="{% url 'pedido_crear_desde_mesa' %}">
        {% csrf_token %}

        <div class="modal-body">
          <input type="hidden" name="mesa_id" id="to_mesa_id">

          <!-- ‚úÖ Aqu√≠ se inyecta el men√∫ paginado -->
          <div id="tomarOrdenBody">
            <div class="text-muted small">Cargando men√∫...</div>
          </div>

        </div>
        

        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-check2-circle me-1"></i> Enviar a cocina
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="https://unpkg.com/htmx.org@1.9.12"></script>
<script>
  document.addEventListener("shown.bs.modal", (ev) => {
    const modal = ev.target;
    if (!modal || modal.id !== "tomarOrdenModal") return;

    console.log("üöÄ Modal Abierto: Reseteando selecci√≥n global");
    window.__tomarOrdenSelected = []; 

    const trigger = ev.relatedTarget;
    if (!trigger) return;

    const mesaId = trigger.getAttribute("data-mesa-id");
    const mesaNumero = trigger.getAttribute("data-mesa-numero");
    // Si est√°s usando agregar item, aseg√∫rate de capturar el pedido_id aqu√≠ si es necesario
    // const pedidoId = trigger.getAttribute("data-pedido-id");

    console.log(`üìç Mesa Seleccionada: ${mesaId} (#${mesaNumero})`);

    document.getElementById("to_mesa_id").value = mesaId || "";
    document.getElementById("to_mesa_numero").textContent = mesaNumero || "";

    const url = "{% url 'tomar_pedido' 0 %}".replace("/0/", `/${mesaId}/`);
    console.log(`üì° Llamando a HTMX: ${url}`);
    htmx.ajax("GET", url, "#tomarOrdenBody");
  });

  // Opcional: Log antes de enviar el formulario
  document.getElementById("tomarOrdenForm").onsubmit = function(e) {
    const data = document.getElementById("platillos_json").value;
    console.log("üì¶ ENVIANDO FORMULARIO POST...");
    console.log("Contenido de platillos_json:", data);
    // Si data es "[]" aqu√≠, el problema es que el input no se est√° llenando
  };
</script>