{% extends "base.html" %}
{% block title %}Inventario{% endblock %}

{% block extra_css %}
<style>
  .tile-card { border:0; transition: transform .15s ease, box-shadow .15s ease; }
  .tile-card:hover { transform: translateY(-2px); box-shadow: 0 .5rem 1rem rgba(0,0,0,.08); }
  .tile-icon { font-size: 1.75rem; opacity:.9; }
</style>
{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h5 mb-0">Inventario</h1>
</div>

<div class="row g-3">
  <!-- Columna principal con tiles -->
  <div class="col-xl-8">
    <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3">

      <!-- Productos -->
      <div class="col">
        <div class="card tile-card h-100">
          <div class="card-body d-flex">
            <div class="me-3">
              <i class="bi bi-box-seam tile-icon text-primary"></i>
            </div>
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between">
                <h2 class="h6 mb-1">Productos</h2>
                <span class="badge text-bg-light">{{ stats.productos }}</span>
              </div>
              <p class="text-muted small mb-2">Altas, edición, impuestos y UM.</p>
              <a href="{% url 'inv-productos-lista' %}" class="stretched-link">Abrir lista</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Categorías -->
      <div class="col">
        <div class="card tile-card h-100">
          <div class="card-body d-flex">
            <div class="me-3">
              <i class="bi bi-tags tile-icon text-primary"></i>
            </div>
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between">
                <h2 class="h6 mb-1">Categorías</h2>
                <span class="badge text-bg-light">{{ stats.categorias }}</span>
              </div>
              <p class="text-muted small mb-2">Organiza tus productos.</p>
              <a href="{% url 'inv-categorias-lista' %}" class="stretched-link">Abrir lista</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Tipos de unidad -->
      <div class="col">
        <div class="card tile-card h-100">
          <div class="card-body d-flex">
            <div class="me-3">
              <i class="bi bi-aspect-ratio tile-icon text-primary"></i>
            </div>
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between">
                <h2 class="h6 mb-1">Tipos de unidad</h2>
                <span class="badge text-bg-light">{{ stats.tipos_um }}</span>
              </div>
              <p class="text-muted small mb-2">UM usadas por productos.</p>
              <a href="{% url 'inv-tiposum-lista' %}" class="stretched-link">Abrir lista</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Impuestos -->
      <div class="col">
        <div class="card tile-card h-100">
          <div class="card-body d-flex">
            <div class="me-3">
              <i class="bi bi-percent tile-icon text-primary"></i>
            </div>
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between">
                <h2 class="h6 mb-1">Impuestos</h2>
                <span class="badge text-bg-light">{{ stats.impuestos }}</span>
              </div>
              <p class="text-muted small mb-2">IVA u otros gravámenes.</p>
              <a href="{% url 'inv-impuestos-lista' %}" class="stretched-link">Abrir lista</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Almacenes -->
      <div class="col">
        <div class="card tile-card h-100">
          <div class="card-body d-flex">
            <div class="me-3">
              <i class="bi bi-buildings tile-icon text-primary"></i>
            </div>
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between">
                <h2 class="h6 mb-1">Almacenes</h2>
                <span class="badge text-bg-light">{{ stats.almacenes }}</span>
              </div>
              <p class="text-muted small mb-2">Ubicaciones y responsables.</p>
              <a href="{% url 'inv-almacenes-lista' %}" class="stretched-link">Abrir lista</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Movimientos -->
      <div class="col">
        <div class="card tile-card h-100">
          <div class="card-body d-flex">
            <div class="me-3">
              <i class="bi bi-arrow-left-right tile-icon text-primary"></i>
            </div>
            <div class="flex-grow-1">
              <div class="d-flex justify-content-between">
                <h2 class="h6 mb-1">Movimientos</h2>
                <span class="badge text-bg-light">{{ stats.movs }}</span>
              </div>
              <p class="text-muted small mb-2">Entradas, salidas y ajustes.</p>
              <a href="{% url 'inv-movs-lista' %}" class="stretched-link">Abrir lista</a>
            </div>
          </div>
        </div>
      </div>

    </div> <!-- /row tiles -->
  </div>

  <!-- Columna lateral: alertas -->
  <div class="col-xl-4">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h2 class="h6 mb-3"><i class="bi bi-exclamation-triangle me-1 text-accent"></i> Stock bajo</h2>

        {% if low_stock %}
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>SKU</th>
                  <th>Producto</th>
                  <th class="text-end">Stock</th>
                  <th class="text-end">Mín</th>
                </tr>
              </thead>
              <tbody>
                {% for p in low_stock %}
                <tr>
                  <td class="text-muted small">{{ p.codigo }}</td>
                  <td class="small">{{ p.descripcion }}</td>
                  <td class="text-end">{{ p.stock }}</td>
                  <td class="text-end">{{ p.stock_minimo }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <a href="{% url 'inv-productos-lista' %}?q=&cat=" class="btn btn-light btn-sm">Ver todos</a>
        {% else %}
          <p class="text-muted small mb-0">No hay productos bajo el mínimo.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
